visited & (1<<i)のはずが、visited & i となっていないかい...?
